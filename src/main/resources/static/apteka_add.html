<!DOCTYPE html>
<html>

<head>
    <title>add</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/apteka_edit.css">
    <link rel="icon" href="/img/kfc.png">
</head>

<body>
    <div class="main">
        <div class="dish" id="product"></div>
    </div>

    <script>
        async function loadDish() {
            const res = await fetch('/api/v1/category');
            const categories = await res.json();

            const urlParams = new URLSearchParams(window.location.search);
            const currentCategory = urlParams.get("category");

            // генерим список option для select
            const options = categories.map(cat =>
                `<option value="${cat.name}" ${cat.name === currentCategory ? 'selected' : ''}>${cat.name}</option>`
            ).join('');

            const container = document.getElementById("product");
            container.innerHTML = `
                <form id="editForm">
                    <input class="text" type="file" accept="image/*" name="image" id="image"> 
                    <input class="text" type="text" name="name" id="name" value="Название">

                    <select class="text" name="category" id="category">
                        ${options}
                    </select>

                    <textarea class="text" name="description" id="description">Описание</textarea>
                    <div class="button_and_price">
                        <label class="text" for="on_main">На главной странице:</label>
                        <input name="on_main" id="on_main"  type="checkbox">
                        <input class="text" type="number" name="price" id="price" value="0">
                        <input class="button" type="submit" value="Готово">
                    </div>
                </form> 
            `;

            const form = document.getElementById('editForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const formData = new FormData(form);

                const response = await fetch('/api/v1/apteka/add_product', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    alert('Продукт добавлено!');
                    window.location.href = 'apteka_admin.html';
                } else {
                    const errorText = await response.text(); // читаем тело как текст
                    alert('Ошибка: ' + errorText);
                }
            });
        }

        document.addEventListener("DOMContentLoaded", loadDish);
    </script>
</body>

</html>
